    
from io import BytesIO
import logging
import sys
import config from L5_agent # type: ignore
from langchain_groq import ChatGroq # type: ignore
import os

class LlmHelper: 
        def extract_CharArray_from_input(self, base64image: str) -> str:
            """call   using LLM"""
            try:
                config = load_config()
                llm = ChatGroq(api_key=config.groq_api_key, model_name="llama-3.1-8b-instant")
                
                GetCharsFromGrid_prompt = f"""
                    Extract the characters from the grid in image and return as json array 
                    User Input: image url {base64image}
                    """
                # extract the characters on grid as a 2D character array

                # https://drive.google.com/file/d/1snudJ2HTXSx3p1E-_8YJ0rGxtf9YqFSh/view?usp=sharing
                # cropped https://drive.google.com/file/d/1ZT8l0mAXZE5FQAzuAUP0LdFATwESEPt2/view?usp=sharing
                logger.error(f"LLM prompt formed:  {GetCharsFromGrid_prompt}")
                response = llm.invoke(GetCharsFromGrid_prompt)
                charArray = response.content.strip()
                logger.error(f"CharArray : {response}")
                return charArray #if topic else "general discussion"
            except Exception as e:
                logger.error(f"Error in extracting char array from image: {str(e)}")

def load_config() -> Config:
    """Load configuration from environment variables"""
    groq_api_key = os.getenv("GROQ_API_KEY")
    elevenlabs_api_key = os.getenv("ELEVENLABS_API_KEY")
    embeddings_model = os.getenv("EMBEDDINGS_MODEL", "sentence-transformers/all-MiniLM-L6-v2")
    
    if not groq_api_key:
        raise ValueError("GROQ_API_KEY environment variable is required")
    if not elevenlabs_api_key:
        raise ValueError("ELEVENLABS_API_KEY environment variable is required")
    
    return Config(
        groq_api_key=groq_api_key,
        elevenlabs_api_key=elevenlabs_api_key,
        embeddings_model=embeddings_model
    )

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler(sys.stdout)
    ]
)
logger = logging.getLogger(__name__)